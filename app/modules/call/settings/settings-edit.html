<div class="huron-settings">
  <div class="loading-container" ng-if="$ctrl.loading">
    <i class="icon icon-spinner"></i>
  </div>

  <form novalidate name="$ctrl.form" ng-if="!$ctrl.loading" class="huron-settings-main-container">
    <!-- Media on Hold settings -->
    <div cr-feature-toggle feature-show="huron-moh-enable" class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="serviceSetupModal.mohTitle"></h4>
        <h6 class="section__description" translate="serviceSetupModal.mohDesc"></h6>
      </div>
      <div class="section__content">
        <div class="sub-section">
          <uc-company-media-on-hold
            company-moh="$ctrl.huronSettingsData.companyMoh"
            company-moh-options="$ctrl.settingsOptions.companyMohOptions"
            on-change-fn="$ctrl.onCompanyMohChanged(companyMoh)">
          </uc-company-media-on-hold>
        </div>
      </div>
    </div>

    <!-- regional settings -->
    <div class="cs-form__section" ng-if="$ctrl.showRegionAndVoicemail">
      <div class="section__info">
          <h4 class="section__title" translate="serviceSetupModal.regionalSettings"></h4>
      </div>
      <div class="section__content">
        <div class="sub-section">
          <uc-time-zone
            time-zone="$ctrl.huronSettingsData.site.timeZone"
            time-zone-options="$ctrl.settingsOptions.timeZoneOptions"
            on-change-fn="$ctrl.onTimeZoneChanged(timeZone)">
          </uc-time-zone>
        </div>
        <div class="sub-section" ng-if="$ctrl.callDateTimeFormat">
          <uc-date-format
            date-format="$ctrl.huronSettingsData.site.dateFormat"
            date-format-options="$ctrl.settingsOptions.dateFormatOptions"
            on-change-fn="$ctrl.onDateFormatChanged(dateFormat)">
          </uc-date-format>
        </div>
        <div class="sub-section" ng-if="$ctrl.callDateTimeFormat">
          <uc-time-format
            time-format="$ctrl.huronSettingsData.site.timeFormat"
            time-format-options="$ctrl.settingsOptions.timeFormatOptions"
            on-change-fn="$ctrl.onTimeFormatChanged(timeFormat)">
          </uc-time-format>
        </div>
        <div class="sub-section service-setup service-setup-regional-settings">
          <uc-settings-preferred-language
            preferred-language="$ctrl.huronSettingsData.site.preferredLanguage"
            preferred-language-options="$ctrl.settingsOptions.preferredLanguageOptions"
            on-change-fn="$ctrl.onPreferredLanguageChanged(preferredLanguage)">
          </uc-settings-preferred-language>
        </div>
        <div
          cr-feature-toggle feature-show="h-regional-tones"
          class="sub-section service-setup service-setup-regional-settings">
          <uc-default-country
            default-country="$ctrl.huronSettingsData.site.country"
            default-country-options="$ctrl.settingsOptions.defaultCountryOptions"
            on-change-fn="$ctrl.onDefaultCountryChanged(defaultCountry)">
          </uc-default-country>
        </div>
      </div>
    </div>

    <!-- internal dialing section -->
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="serviceSetupModal.internalDialing"></h4>
      </div>
      <div class="section__content">
        <div class="sub-section">
          <uc-routing-prefix
            routing-prefix="$ctrl.huronSettingsData.site.routingPrefix"
            on-change-fn="$ctrl.onRoutingPrefixChanged(routingPrefix)">
          </uc-routing-prefix>
        </div>
        <div class="sub-section">
          <uc-extension-length
            first-time-setup="$ctrl.ftsw"
            extension-length="$ctrl.huronSettingsData.site.extensionLength"
            settings-data="$ctrl.huronSettingsData"
            extension-decrease-allowed="$ctrl.settingsOptions.extensionDecreaseAllowed"
            extension-length-saved-fn="$ctrl.onExtensionLengthSaved()"
            decrease-extension-length-fn="$ctrl.onDecreaseExtensionLength(extensionLength)"
            on-change-fn="$ctrl.onExtensionLengthChanged(extensionLength)">
          </uc-extension-length>
        </div>
        <div class="sub-section">
          <uc-extension-range
            steering-digit="$ctrl.huronSettingsData.site.steeringDigit"
            extension-length="$ctrl.huronSettingsData.site.extensionLength"
            number-ranges="$ctrl.huronSettingsData.internalNumberRanges"
            first-time-setup="$ctrl.ftsw"
            on-change-fn="$ctrl.onExtensionRangeChanged(extensionRanges)">
          </uc-extension-range>
        </div>
      </div>
    </div>

    <!-- external dialing section -->
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="serviceSetupModal.externalDialing"></h4>
      </div>
      <div class="section__content">
        <div class="sub-section">
          <uc-outbound-dial-digit
            steering-digit="$ctrl.huronSettingsData.site.steeringDigit"
            internal-number-ranges="$ctrl.huronSettingsData.internalNumberRanges"
            is-terminus-customer="$ctrl.isTerminusCustomer"
            on-change-fn="$ctrl.onSteeringDigitChanged(steeringDigit)">
          </uc-outbound-dial-digit>
        </div>
        <div
          class="sub-section"
          ng-if="$ctrl.settingsOptions.dialPlan.supportsSimplifiedNationalDialing || $ctrl.settingsOptions.dialPlan.supportsLocalDialing">
          <uc-dialing-setup
            steering-digit="$ctrl.huronSettingsData.site.steeringDigit"
            use-simplified-national-dialing="$ctrl.huronSettingsData.site.regionCodeDialing.useSimplifiedNationalDialing"
            supports-simplified-national-dialing="$ctrl.settingsOptions.dialPlan.supportsSimplifiedNationalDialing"
            supports-local-dialing="$ctrl.settingsOptions.dialPlan.supportsLocalDialing"
            region-code="$ctrl.huronSettingsData.site.regionCodeDialing.regionCode"
            is-terminus-customer="$ctrl.isTerminusCustomer"
            on-change-fn="$ctrl.onRegionCodeChanged(regionCode, useSimplifiedNationalDialing)">
          </uc-dialing-setup>
        </div>
      </div>
    </div>

    <!-- cos restrictions selection -->
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="serviceSetupModal.cos.title"></h4>
        <h6 class="section__description" translate="serviceSetupModal.cos.desc"></h6>
      </div>
      <div class="section__content">
        <uc-cos-form
          cos-restrictions="$ctrl.huronSettingsData.cosRestrictions"
          premium-numbers="$ctrl.settingsOptions.dialPlan.premiumNumbers"
          on-change-fn="$ctrl.onCustomerCosRestrictionsChanged(restrictions)">
        </uc-cos-form>
      </div>
    </div>

    <!-- emergency service address selection -->
    <div class="cs-form__section" ng-if="$ctrl.showEmergencyServiceAddress">
      <div class="section__info">
        <h4 class="section__title" translate="settingsServiceAddress.label"></h4>
        <h6 class="section__description" translate="serviceSetupModal.emergencyAddressDescription"></h6>
      </div>
      <div class="section__content">
        <uc-emergency-service-address></uc-emergency-service-address>
      </div>
    </div>

    <!-- emergency service number selection -->
    <div class="cs-form__section" ng-if="$ctrl.showEmergencyServiceAddress">
      <div class="section__info">
        <h4 class="section__title" translate="settingsServiceNumber.label"></h4>
        <h6 class="section__description" translate="settingsServiceNumber.description"></h6>
      </div>
      <div class="section__content">
        <uc-emergency-service-number
          voicemail-pilot-number="$ctrl.huronSettingsData.site.voicemailPilotNumber"
          emergency-callback-number="$ctrl.huronSettingsData.site.emergencyCallBackNumber"
          external-number-options="$ctrl.settingsOptions.emergencyServiceNumberOptions"
          on-number-filter-fn="$ctrl.onEmergencyServiceNumberFilter(filter)"
          on-change-fn="$ctrl.onEmergencyServiceNumberChanged(emergencyCallbackNumber)">
        </uc-emergency-service-number>
      </div>
    </div>

    <!-- external call transfer/conference selection -->
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="externalTransfer.title"></h4>
      </div>
      <div class="section__content">
        <uc-ext-transfer-org
          location="false"
          on-change-fn="$ctrl.onExtTransferChanged(allowExternalTransfer)"
          allow-external-transfer="$ctrl.huronSettingsData.site.allowExternalTransfer">
        </uc-ext-transfer-org>
      </div>
    </div>

    <!-- company caller id selection -->
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="companyCallerId.companyCallerId"></h4>
        <h6 class="section__description" translate="companyCallerId.companyCallerIdDesc"></h6>
      </div>
      <div class="section__content">
        <uc-company-caller-id
          voicemail-pilot-number="$ctrl.huronSettingsData.site.voicemailPilotNumber"
          company-caller-id="$ctrl.huronSettingsData.companyCallerId"
          external-number-options="$ctrl.settingsOptions.companyCallerIdOptions"
          customer-name="$ctrl.huronSettingsData.customer.name"
          on-number-filter="$ctrl.onCompanyCallerIdFilter(filter)"
          on-change-fn="$ctrl.onCompanyCallerIdChanged(companyCallerId)">
        </uc-company-caller-id>
      </div>
    </div>

    <!-- company voicemail selection -->
    <div class="cs-form__section" ng-if="$ctrl.showRegionAndVoicemail">
      <div class="section__info">
        <h4 class="section__title" translate="serviceSetupModal.companyVoicemail"></h4>
      </div>
      <div class="section__content">
        <div ng-if="!$ctrl.avrilI1559">
          <uc-company-voicemail-avril
            ng-if="$ctrl.supportsAvrilVoicemail || $ctrl.supportsAvrilVoicemailMailbox"
            site="$ctrl.huronSettingsData.site"
            features="$ctrl.huronSettingsData.avrilFeatures"
            dial-plan-country-code="$ctrl.settingsOptions.dialPlan.countryCode"
            external-number-options="$ctrl.settingsOptions.companyVoicemailOptions"
            company-voicemail-enabled="$ctrl.huronSettingsData.customer.hasVoicemailService"
            voicemail-to-email="$ctrl.huronSettingsData.voicemailToEmailSettings.voicemailToEmail"
            on-change-fn="$ctrl.onCompanyVoicemailAvrilChanged(voicemailPilotNumber, voicemailPilotNumberGenerated, companyVoicemailEnabled, features)"
            on-number-filter="$ctrl.onCompanyVoicemailFilter(filter)">
          </uc-company-voicemail-avril>
        </div>
        <div ng-if="$ctrl.avrilI1559">
          <uc-company-voicemail-avril-i1559
            ng-if="$ctrl.supportsAvrilVoicemail || $ctrl.supportsAvrilVoicemailMailbox"
            site="$ctrl.huronSettingsData.site"
            features="$ctrl.huronSettingsData.avrilFeatures"
            dial-plan-country-code="$ctrl.settingsOptions.dialPlan.countryCode"
            external-number-options="$ctrl.settingsOptions.companyVoicemailOptions"
            company-voicemail-enabled="$ctrl.huronSettingsData.customer.hasVoicemailService"
            on-change-fn="$ctrl.onCompanyVoicemailAvrilChanged(voicemailPilotNumber, voicemailPilotNumberGenerated, companyVoicemailEnabled, features)"
            on-number-filter="$ctrl.onCompanyVoicemailFilter(filter)">
          </uc-company-voicemail-avril-i1559>
        </div>
      </div>
    </div>

    <div class="save-section" ng-class="{invisible: !$ctrl.form.$dirty}">
      <p></p>
      <button ng-click="$ctrl.onCancel()" translate="common.cancel"></button>
      <button class="btn btn--primary" cs-btn loading="$ctrl.processing" ng-click="$ctrl.showSaveDialogs()" ng-disabled="$ctrl.form.$invalid"><span translate="common.save"></span></button>
    </div>
  </form>
</div>

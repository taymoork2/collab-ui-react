<cs-sp-section ng-if="$ctrl.ccaDomainId" class="section gm-td-notes-view side-panel-history">
  <div class="section-title-row">
    <div class="section-name">
      <i class="icon icon-2x {{$ctrl.isCollapsed ? 'icon-chevron-right': 'icon-chevron-down'}}"
         ng-click="$ctrl.onCollapse()"></i>
      <span translate="gemini.cbgs.notes.notes"></span>
    </div>
  </div>
  <div class="section-content" collapse="$ctrl.isCollapsed">
    <div class="columns medium-6">
      <div ng-if="$ctrl.isLoading">
        <i class="icon icon-spinner"></i>
      </div>
      <div ng-if="$ctrl.model.length === 0 && !$ctrl.isLoading">
        <small translate="gemini.cbgs.notes.noNoteMsg"></small>
      </div>

      <ul ng-if="!$ctrl.isLoading" class="history-ul">
        <li ng-repeat="note in $ctrl.model | limitTo: $ctrl.displayCount track by $index">
          <small>{{note.actionTime}} {{'gemini.cbgs.by' | translate}} {{note.userName}} {{!note.email ? '' : '(' +
            note.email + ')'}}
          </small>
          <h6>{{note.objectName}}</h6>
        </li>
        <li><div ng-if="$ctrl.displayCount < $ctrl.model.length"><a href ng-click="$ctrl.onShowAll()" translate="gemini.cbgs.showMore"></a></div></li>
      </ul>
    </div>
    <div class="columns medium-6">
      <span class="feature-name" translate="gemini.cbgs.notes.newNote"></span>
      <form name="noteForm" novalidate
            ng-class="{'error': noteForm.noteContent.$invalid && noteForm.noteContent.$dirty && noteForm.noteContent.$touched}">
        <div class="cs-input-group medium-12 columns">
          <textarea name="noteContent" rows="5" ng-maxlength="2048" ng-model="$ctrl.newNote" required
                    class="form-control optional-row"
                    placeholder="{{'gemini.cbgs.notes.enterNote' | translate}}"></textarea>
        </div>
        <div class="pull-left">
          <button class="btn btn--primary" cs-btn
                  loading="$ctrl.isSubmitting"
                  ng-click="$ctrl.onSave()"
                  ng-disabled="noteForm.$invalid">
            <span translate="gemini.cbgs.notes.addNote"></span>
          </button>
        </div>
        <div class="pull-right">
          <div class="cs-input__messages" ng-messages="noteForm.noteContent.$error" role="alert" ng-if='noteForm.noteContent.$touched'>
            <div class="message" ng-message="required" translate="common.invalidRequired"></div>
            <div class="message" ng-message="maxlength"
                 translate="gemini.inputLengthError"
                 translate-values="{length: 2048, field: 'note'}"></div>
          </div>
        </div>
      </form>
    </div>
    <div class="clearfix"></div>
  </div>
</cs-sp-section>


<div class="subscriptions-container">
  <cr-trial-notice-banner ng-if="mcpSub.hasEnterpriseTrial || mcpSub.trialUrlFailed"></cr-trial-notice-banner>
  <cs-card-layout block-view="true">
    <cs-card class="full subscriptions detail-view" ng-repeat="subscription in mcpSub.subscriptionDetails" ng-if="mcpSub.subscriptionDetails.length > 1" ng-class="{'subscription-expanded': subscription.viewAll}">
      <article><section>
        <div class="columns medium-2 subscription-header">
          <div class="icon-container" ng-click="subscription.viewAll = !subscription.viewAll" ng-class="{'icon-container-down': subscription.viewAll}">
            <i class="icon icon-right-arrow-contained"></i>
          </div>
          <h4 class="sub-name">{{::subscription.name}}</h4>
        </div>
        <div class="columns medium-8 subscription-column">
          <div ng-repeat="license in subscription.licenses" class="detail" ng-if="($index < 3) || subscription.viewAll" ng-class="{'tooltip-present': !subscription.viewAll}" tooltip-html-unsafe="{{::license.tooltip}}" tooltip-enable="!subscription.viewAll && license.tooltip" tooltip-placement="top-left" tooltip-class="subscription-tooltip" tooltip-append-to-body="true">
            <i class="icon {{::license.class}} icon-detail" ng-if="license.class"></i>
            <span class="h6" translate="subscriptions.licenseTypes.{{::license.offerName}}"></span>
            <div class="detail-break" ng-class="{'match-icon': license.class}" ng-if="subscription.viewAll">
              <span class="h6" translate="subscriptions.usage"></span>
              <span class="h6" ng-class="{'warning': license.usage > license.volume}">{{::license.usage}}/{{::license.volume}}</span>
            </div>
          </div>
        </div>
        <div class="columns medium-2 subscription-upgrade">
          <div class="license-quantity">
            <bmmp-subscription-upgrade-button ng-if="subscription.isOnline"
              class="btn btn--primary upgrade-button"
              bmmp-attr="mcpSub.bmmpAttr"
              widget-location="navigation-bar">
            </bmmp-subscription-upgrade-button>
          </div>
          <div class="subscription-id" ng-if="subscription.viewAll">
            <span class="h6" translate="subscriptions.subscription"></span>
            <span class="h6">{{::subscription.subscriptionId}}</span>
          </div>
        </div>
      </section></article>
    </cs-card>

    <cs-card class="full subscriptions" ng-if="mcpSub.hybridServices.length > 0 || mcpSub.visibleSubscriptions">
      <article>
        <section>
          <div class="row">
            <h3 class="column medium-2 sub-name" translate="subscriptions.licenseSummary"></h3>
            <div class="column medium-5 sub-id" ng-if="mcpSub.subscriptionDetails.length === 1 && (!mcpSub.subscriptionDetails[0].isTrial || mcpSub.subscriptionDetails[0].isOnline) && mcpSub.subscriptionDetails[0].subscriptionId">
              <span class="h6" translate="subscriptions.subscription"></span>
              <span class="h6">{{::mcpSub.subscriptionDetails[0].subscriptionId}}</span>
            </div>
          </div>
          <div class="row" ng-repeat="licenseCategory in mcpSub.licenseCategory" ng-show="mcpSub.showCategory(licenseCategory)">
            <h5 class="columns medium-2 subscription-type">{{::licenseCategory.label}}</h5>
            <div class="columns medium-10 subscription-column">
              <!-- if category does not wrap offers -->
              <div ng-if="!mcpSub.wrapsOffers(licenseCategory)" class="subscription-item" ng-repeat="offer in licenseCategory.offers">
                <cs-donut name="offer.id" value="offer.usage" max="offer.volume" ssize="48" class="text-center"></cs-donut>
                <div class="subscription-description">
                  <div class="h5" translate="subscriptions.licenseTypes.{{::offer.offerName}}"></div>
                  <div>
                    <span class="h6" translate="subscriptions.usage"></span>
                    <span class="h6" ng-class="{ 'warning': mcpSub.getWarning(offer) }">{{::offer.usage}}/{{::offer.volume}}</span>
                  </div>
                </div>
              </div>

              <!-- if category wraps offers -->
              <div ng-if="mcpSub.wrapsOffers(licenseCategory)" class="subscription-item" ng-class="{'item-with-borders': !(mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsEnabled)}" ng-repeat="wrapper in licenseCategory.offerWrapper">
                <div class="license-item" ng-repeat="offer in wrapper.offers">
                  <div class="license-count-indicator" ng-if="!offer.siteUrl || (offer.siteUrl && !mcpSub.isSharedMeetingsLicense(offer))">
                    <cs-donut name="offer.id" hideusage="mcpSub.hideUsage(offer)" value="offer.usage" max="offer.volume" ssize="48" class="text-center"></cs-donut>
                  </div>
                  <div class="subscription-description subscription-detail" ng-class="{'subscription-advanced-detail': mcpSub.isSharedMeetingsLicense(offer)}">
                    <div class="name h5" translate="subscriptions.licenseTypes.{{::offer.offerName}}"></div>
                    <div class="h6 subscription-site siteUrl" ng-if="offer.siteUrl">{{::offer.siteUrl}}</div>
                    <div ng-if="subscription.siteUrl && mcpSub.isSharedMeetingsEnabled && !mcpSub.isSharedMeetingsLicense(offer)">
                      <span class="name h6">{{mcpSub.determineLicenseType(offer)}}</span>
                    </div>
                    <!-- For CI sites -->
                    <div ng-if="!mcpSub.hideUsage(offer) && !(mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsEnabled)">
                      <span class="h6" translate="subscriptions.usage"></span>
                      <span class="h6" ng-class="{'warning': offer.usage > offer.volume}">{{::offer.usage}}/{{::offer.volume}}</span>
                    </div>

                    <!-- For non-CI sites -->
                    <div ng-if="mcpSub.hideUsage(offer) && !(mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsEnabled)">
                      <span class="h6" translate="subscriptions.quantity"></span>
                      <span class="h6">{{::offer.volume}}</span>
                    </div>
                    <div ng-if="mcpSub.hideUsage(offer) && !(mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsEnabled)">
                      <a class="h6 link" translate="subscriptions.signIn" ng-click="mcpSub.nonCISignIn(offer)"></a>
                    </div>
                  </div>
                  <div class="subscription-description subscription-detail" ng-if="mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsReportsEnabled">
                    <div class="h5 license-detail" ng-class="{'warning': offer.usage > offer.volume}" translate="sharedMeetingReports.hostsSharingLicenses" translate-values="{usage: offer.usage, volume: offer.volume}"></div>
                    <div>
                      <span class="h6" translate="sharedMeetingReports.title"></span>
                      <a class="name h6 link" ng-click="mcpSub.launchSharedMeetingsLicenseUsageReport(offer.siteUrl)" translate="sharedMeetingReports.link"></a>
                    </div>
                  </div>
                  <div class="subscription-description subscription-detail" ng-if="mcpSub.isSharedMeetingsLicense(offer) && mcpSub.isSharedMeetingsReportsEnabled">
                    <span class="h5 license-detail" translate="sharedMeetingReports.availableSharedLicenses"></span>
                    <span class="h6">{{::offer.volume}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row" ng-show="mcpSub.hybridServices && mcpSub.hybridServices.length > 0">
            <h5 class="columns medium-2 subscription-type" translate="subscriptions.hybrid"></h5>
            <div class="columns medium-10 subscription-column">
              <ul class="hybrid-ul">
                <li ng-repeat="service in mcpSub.hybridServices">
                  <i class="icon icon-circle"></i>
                  <span class="h6">{{::service}}</span>
                </li>
              </ul>
            </div>
          </div>
        </section>
      </article>
    </cs-card>
  </cs-card-layout>
</div>
